import { Binary, BinarySizes } from "./binary.ts";
import { bufferToUuidHexString, uuidHexStringToBuffer, uuidValidateString, } from "./uuid_utils.ts";
import { randomBytes } from "./parser/utils.ts";
import { BSONTypeError } from "./error.ts";
import { equals } from "../deps.ts";
const BYTE_LENGTH = 16;
export class UUID {
    static cacheHexString;
    #bytesBuffer;
    #id;
    constructor(input) {
        if (typeof input === "undefined") {
            this.id = UUID.generate();
        }
        else if (input instanceof UUID) {
            this.#bytesBuffer = input.id;
            this.#id = input.#id;
        }
        else if (ArrayBuffer.isView(input) && input.byteLength === BYTE_LENGTH) {
            this.id = input;
        }
        else if (typeof input === "string") {
            this.id = uuidHexStringToBuffer(input);
        }
        else {
            throw new BSONTypeError("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");
        }
        this.#bytesBuffer = this.id;
    }
    get id() {
        return this.#bytesBuffer;
    }
    set id(value) {
        this.#bytesBuffer = value;
        if (UUID.cacheHexString) {
            this.#id = bufferToUuidHexString(value);
        }
    }
    toHexString(includeDashes = true) {
        if (UUID.cacheHexString && this.#id) {
            return this.#id;
        }
        const uuidHexString = bufferToUuidHexString(this.id, includeDashes);
        if (UUID.cacheHexString) {
            this.#id = uuidHexString;
        }
        return uuidHexString;
    }
    toString() {
        return this.toHexString();
    }
    toJSON() {
        return this.toHexString();
    }
    equals(otherId) {
        if (!otherId) {
            return false;
        }
        if (otherId instanceof UUID) {
            return equals(otherId.id, this.id);
        }
        try {
            return equals(new UUID(otherId).id, this.id);
        }
        catch {
            return false;
        }
    }
    toBinary() {
        return new Binary(this.id, BinarySizes.SUBTYPE_UUID);
    }
    static generate() {
        const bytes = randomBytes(BYTE_LENGTH);
        bytes[6] = (bytes[6] & 0x0f) | 0x40;
        bytes[8] = (bytes[8] & 0x3f) | 0x80;
        return bytes;
    }
    static isValid(input) {
        if (!input) {
            return false;
        }
        if (input instanceof UUID) {
            return true;
        }
        if (typeof input === "string") {
            return uuidValidateString(input);
        }
        if (input instanceof Uint8Array) {
            if (input.length !== BYTE_LENGTH) {
                return false;
            }
            try {
                return parseInt(input[6].toString(16)[0], 10) ===
                    BinarySizes.SUBTYPE_UUID;
            }
            catch {
                return false;
            }
        }
        return false;
    }
    static createFromHexString(hexString) {
        const buffer = uuidHexStringToBuffer(hexString);
        return new UUID(buffer);
    }
    [Symbol.for("Deno.customInspect")]() {
        return `new UUID("${this.toHexString()}")`;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXVpZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV1aWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDbEQsT0FBTyxFQUNMLHFCQUFxQixFQUNyQixxQkFBcUIsRUFDckIsa0JBQWtCLEdBQ25CLE1BQU0saUJBQWlCLENBQUM7QUFDekIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDM0MsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFlBQVksQ0FBQztBQUNwQyxNQUFNLFdBQVcsR0FBRyxFQUFFLENBQUM7QUFNdkIsTUFBTSxPQUFPLElBQUk7SUFDZixNQUFNLENBQUMsY0FBYyxDQUFVO0lBRS9CLFlBQVksQ0FBYTtJQUN6QixHQUFHLENBQVU7SUFPYixZQUFZLEtBQWtDO1FBQzVDLElBQUksT0FBTyxLQUFLLEtBQUssV0FBVyxFQUFFO1lBRWhDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQzNCO2FBQU0sSUFBSSxLQUFLLFlBQVksSUFBSSxFQUFFO1lBQ2hDLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUM3QixJQUFJLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUM7U0FDdEI7YUFBTSxJQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLFVBQVUsS0FBSyxXQUFXLEVBQUU7WUFDeEUsSUFBSSxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUM7U0FDakI7YUFBTSxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtZQUNwQyxJQUFJLENBQUMsRUFBRSxHQUFHLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3hDO2FBQU07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QUFDLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQzNDLFdBQVcsQ0FBQyxZQUFZLENBQUM7YUFDNUI7WUFBQyxNQUFNO2dCQUNOLE9BQU8sS0FBSyxDQUFDO2FBQ2Q7U0FDRjtRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQU1ELE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxTQUFpQjtRQUMxQyxNQUFNLE1BQU0sR0FBRyxxQkFBcUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNoRCxPQUFPLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUNoQyxPQUFPLGFBQWEsSUFBSSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUM7SUFDN0MsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmluYXJ5LCBCaW5hcnlTaXplcyB9IGZyb20gXCIuL2JpbmFyeS50c1wiO1xuaW1wb3J0IHtcbiAgYnVmZmVyVG9VdWlkSGV4U3RyaW5nLFxuICB1dWlkSGV4U3RyaW5nVG9CdWZmZXIsXG4gIHV1aWRWYWxpZGF0ZVN0cmluZyxcbn0gZnJvbSBcIi4vdXVpZF91dGlscy50c1wiO1xuaW1wb3J0IHsgcmFuZG9tQnl0ZXMgfSBmcm9tIFwiLi9wYXJzZXIvdXRpbHMudHNcIjtcbmltcG9ydCB7IEJTT05UeXBlRXJyb3IgfSBmcm9tIFwiLi9lcnJvci50c1wiO1xuaW1wb3J0IHsgZXF1YWxzIH0gZnJvbSBcIi4uL2RlcHMudHNcIjtcbmNvbnN0IEJZVEVfTEVOR1RIID0gMTY7XG5cbi8qKlxuICogQSBjbGFzcyByZXByZXNlbnRhdGlvbiBvZiB0aGUgQlNPTiBVVUlEIHR5cGUuXG4gKiBAcHVibGljXG4gKi9cbmV4cG9ydCBjbGFzcyBVVUlEIHtcbiAgc3RhdGljIGNhY2hlSGV4U3RyaW5nOiBib29sZWFuO1xuXG4gICNieXRlc0J1ZmZlcjogVWludDhBcnJheTtcbiAgI2lkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4gVVVJRCB0eXBlXG4gICAqXG4gICAqIEBwYXJhbSBpbnB1dCAtIENhbiBiZSBhIDMyIG9yIDM2IGNoYXJhY3RlciBoZXggc3RyaW5nIChkYXNoZXMgZXhjbHVkZWQvaW5jbHVkZWQpIG9yIGEgMTYgYnl0ZSBiaW5hcnkgQnVmZmVyLlxuICAgKi9cbiAgY29uc3RydWN0b3IoaW5wdXQ/OiBzdHJpbmcgfCBVaW50OEFycmF5IHwgVVVJRCkge1xuICAgIGlmICh0eXBlb2YgaW5wdXQgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIC8vIFRoZSBtb3N0IGNvbW1vbiB1c2UgY2FzZSAoYmxhbmsgaWQsIG5ldyBVVUlEKCkgaW5zdGFuY2UpXG4gICAgICB0aGlzLmlkID0gVVVJRC5nZW5lcmF0ZSgpO1xuICAgIH0gZWxzZSBpZiAoaW5wdXQgaW5zdGFuY2VvZiBVVUlEKSB7XG4gICAgICB0aGlzLiNieXRlc0J1ZmZlciA9IGlucHV0LmlkO1xuICAgICAgdGhpcy4jaWQgPSBpbnB1dC4jaWQ7XG4gICAgfSBlbHNlIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcoaW5wdXQpICYmIGlucHV0LmJ5dGVMZW5ndGggPT09IEJZVEVfTEVOR1RIKSB7XG4gICAgICB0aGlzLmlkID0gaW5wdXQ7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMuaWQgPSB1dWlkSGV4U3RyaW5nVG9CdWZmZXIoaW5wdXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgQlNPTlR5cGVFcnJvcihcbiAgICAgICAgXCJBcmd1bWVudCBwYXNzZWQgaW4gVVVJRCBjb25zdHJ1Y3RvciBtdXN0IGJlIGEgVVVJRCwgYSAxNiBieXRlIEJ1ZmZlciBvciBhIDMyLzM2IGNoYXJhY3RlciBoZXggc3RyaW5nIChkYXNoZXMgZXhjbHVkZWQvaW5jbHVkZWQsIGZvcm1hdDogeHh4eHh4eHgteHh4eC14eHh4LXh4eHgteHh4eHh4eHh4eHh4KS5cIixcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuI2J5dGVzQnVmZmVyID0gdGhpcy5pZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgVVVJRCBieXRlc1xuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIGdldCBpZCgpOiBVaW50OEFycmF5IHtcbiAgICByZXR1cm4gdGhpcy4jYnl0ZXNCdWZmZXI7XG4gIH1cblxuICBzZXQgaWQodmFsdWU6IFVpbnQ4QXJyYXkpIHtcbiAgICB0aGlzLiNieXRlc0J1ZmZlciA9IHZhbHVlO1xuXG4gICAgaWYgKFVVSUQuY2FjaGVIZXhTdHJpbmcpIHtcbiAgICAgIHRoaXMuI2lkID0gYnVmZmVyVG9VdWlkSGV4U3RyaW5nKHZhbHVlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgVVVJRCBpZCBhcyBhIDMyIG9yIDM2IGNoYXJhY3RlciBoZXggc3RyaW5nIHJlcHJlc2VudGF0aW9uLCBleGNsdWRpbmcvaW5jbHVkaW5nIGRhc2hlcyAoZGVmYXVsdHMgdG8gMzYgY2hhcmFjdGVyIGRhc2ggc2VwYXJhdGVkKVxuICAgKiBAcGFyYW0gaW5jbHVkZURhc2hlcyAtIHNob3VsZCB0aGUgc3RyaW5nIGV4Y2x1ZGUgZGFzaC1zZXBhcmF0b3JzLlxuICAgKi9cbiAgdG9IZXhTdHJpbmcoaW5jbHVkZURhc2hlcyA9IHRydWUpOiBzdHJpbmcge1xuICAgIGlmIChVVUlELmNhY2hlSGV4U3RyaW5nICYmIHRoaXMuI2lkKSB7XG4gICAgICByZXR1cm4gdGhpcy4jaWQ7XG4gICAgfVxuXG4gICAgY29uc3QgdXVpZEhleFN0cmluZyA9IGJ1ZmZlclRvVXVpZEhleFN0cmluZyh0aGlzLmlkLCBpbmNsdWRlRGFzaGVzKTtcblxuICAgIGlmIChVVUlELmNhY2hlSGV4U3RyaW5nKSB7XG4gICAgICB0aGlzLiNpZCA9IHV1aWRIZXhTdHJpbmc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHV1aWRIZXhTdHJpbmc7XG4gIH1cblxuICAvKipcbiAgICogc2FtZSBhcyB0byBgdG9IZXhTdHJpbmdgIG1ldGhvZFxuICAgKi9cbiAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy50b0hleFN0cmluZygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIHRoZSBpZCBpbnRvIGl0cyBKU09OIHN0cmluZyByZXByZXNlbnRhdGlvbi5cbiAgICogQSAzNiBjaGFyYWN0ZXIgKGRhc2hlcyBpbmNsdWRlZCkgaGV4IHN0cmluZyBpbiB0aGUgZm9ybWF0OiB4eHh4eHh4eC14eHh4LXh4eHgteHh4eC14eHh4eHh4eHh4eHhcbiAgICovXG4gIHRvSlNPTigpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnRvSGV4U3RyaW5nKCk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcGFyZXMgdGhlIGVxdWFsaXR5IG9mIHRoaXMgVVVJRCB3aXRoIGBvdGhlcklEYC5cbiAgICpcbiAgICogQHBhcmFtIG90aGVySWQgLSBVVUlEIGluc3RhbmNlIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICovXG4gIGVxdWFscyhvdGhlcklkOiBzdHJpbmcgfCBVaW50OEFycmF5IHwgVVVJRCk6IGJvb2xlYW4ge1xuICAgIGlmICghb3RoZXJJZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmIChvdGhlcklkIGluc3RhbmNlb2YgVVVJRCkge1xuICAgICAgcmV0dXJuIGVxdWFscyhvdGhlcklkLmlkLCB0aGlzLmlkKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGVxdWFscyhuZXcgVVVJRChvdGhlcklkKS5pZCwgdGhpcy5pZCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBCaW5hcnkgaW5zdGFuY2UgZnJvbSB0aGUgY3VycmVudCBVVUlELlxuICAgKi9cbiAgdG9CaW5hcnkoKTogQmluYXJ5IHtcbiAgICByZXR1cm4gbmV3IEJpbmFyeSh0aGlzLmlkLCBCaW5hcnlTaXplcy5TVUJUWVBFX1VVSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBhIHBvcHVsYXRlZCBidWZmZXIgY29udGFpbmluZyBhIHY0IHV1aWRcbiAgICovXG4gIHN0YXRpYyBnZW5lcmF0ZSgpOiBVaW50OEFycmF5IHtcbiAgICBjb25zdCBieXRlcyA9IHJhbmRvbUJ5dGVzKEJZVEVfTEVOR1RIKTtcblxuICAgIC8vIFBlciA0LjQsIHNldCBiaXRzIGZvciB2ZXJzaW9uIGFuZCBgY2xvY2tfc2VxX2hpX2FuZF9yZXNlcnZlZGBcbiAgICAvLyBLaW5kbHkgYm9ycm93ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQvYmxvYi9tYXN0ZXIvc3JjL3Y0LmpzXG4gICAgYnl0ZXNbNl0gPSAoYnl0ZXNbNl0gJiAweDBmKSB8IDB4NDA7XG4gICAgYnl0ZXNbOF0gPSAoYnl0ZXNbOF0gJiAweDNmKSB8IDB4ODA7XG5cbiAgICByZXR1cm4gYnl0ZXM7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGlmIGEgdmFsdWUgaXMgYSB2YWxpZCBic29uIFVVSURcbiAgICogQHBhcmFtIGlucHV0IC0gVVVJRCwgc3RyaW5nIG9yIEJ1ZmZlciB0byB2YWxpZGF0ZS5cbiAgICovXG4gIHN0YXRpYyBpc1ZhbGlkKGlucHV0OiBzdHJpbmcgfCBVaW50OEFycmF5IHwgVVVJRCk6IGJvb2xlYW4ge1xuICAgIGlmICghaW5wdXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBVVUlEKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGlucHV0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gdXVpZFZhbGlkYXRlU3RyaW5nKGlucHV0KTtcbiAgICB9XG5cbiAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgICAvLyBjaGVjayBmb3IgbGVuZ3RoICYgdXVpZCB2ZXJzaW9uIChodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNDEyMiNzZWN0aW9uLTQuMS4zKVxuICAgICAgaWYgKGlucHV0Lmxlbmd0aCAhPT0gQllURV9MRU5HVEgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBnZXQgdGhpcyBieXRlIGFzIGhleDogICAgICAgICAgICAgeHh4eHh4eHgteHh4eC1YWHh4LXh4eHgteHh4eHh4eHh4eHh4XG4gICAgICAgIC8vIGNoZWNrIGZpcnN0IHBhcnQgYXMgdXVpZCB2ZXJzaW9uOiB4eHh4eHh4eC14eHh4LVh4eHgteHh4eC14eHh4eHh4eHh4eHhcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGlucHV0WzZdLnRvU3RyaW5nKDE2KVswXSwgMTApID09PVxuICAgICAgICAgIEJpbmFyeVNpemVzLlNVQlRZUEVfVVVJRDtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW4gVVVJRCBmcm9tIGEgaGV4IHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBhbiBVVUlELlxuICAgKiBAcGFyYW0gaGV4U3RyaW5nIC0gMzIgb3IgMzYgY2hhcmFjdGVyIGhleCBzdHJpbmcgKGRhc2hlcyBleGNsdWRlZC9pbmNsdWRlZCkuXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlRnJvbUhleFN0cmluZyhoZXhTdHJpbmc6IHN0cmluZyk6IFVVSUQge1xuICAgIGNvbnN0IGJ1ZmZlciA9IHV1aWRIZXhTdHJpbmdUb0J1ZmZlcihoZXhTdHJpbmcpO1xuICAgIHJldHVybiBuZXcgVVVJRChidWZmZXIpO1xuICB9XG5cbiAgW1N5bWJvbC5mb3IoXCJEZW5vLmN1c3RvbUluc3BlY3RcIildKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBuZXcgVVVJRChcIiR7dGhpcy50b0hleFN0cmluZygpfVwiKWA7XG4gIH1cbn1cbiJdfQ==