/*!
 * Adapted directly from type-is at https://github.com/jshttp/type-is/
 * which is licensed as follows:
 *
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */
import { lookup } from "./deps.ts";
import { format, parse } from "./mediaTyper.ts";
function mimeMatch(expected, actual) {
    if (expected === undefined) {
        return false;
    }
    const actualParts = actual.split("/");
    const expectedParts = expected.split("/");
    if (actualParts.length !== 2 || expectedParts.length !== 2) {
        return false;
    }
    const [actualType, actualSubtype] = actualParts;
    const [expectedType, expectedSubtype] = expectedParts;
    if (expectedType !== "*" && expectedType !== actualType) {
        return false;
    }
    if (expectedSubtype.substr(0, 2) === "*+") {
        return (expectedSubtype.length <= actualSubtype.length + 1 &&
            expectedSubtype.substr(1) ===
                actualSubtype.substr(1 - expectedSubtype.length));
    }
    if (expectedSubtype !== "*" && expectedSubtype !== actualSubtype) {
        return false;
    }
    return true;
}
function normalize(type) {
    if (type === "urlencoded") {
        return "application/x-www-form-urlencoded";
    }
    else if (type === "multipart") {
        return "multipart/*";
    }
    else if (type[0] === "+") {
        return `*/*${type}`;
    }
    return type.includes("/") ? type : lookup(type);
}
function normalizeType(value) {
    try {
        const val = value.split(";");
        const type = parse(val[0]);
        return format(type);
    }
    catch {
        return;
    }
}
export function isMediaType(value, types) {
    const val = normalizeType(value);
    if (!val) {
        return false;
    }
    if (!types.length) {
        return val;
    }
    for (const type of types) {
        if (mimeMatch(normalize(type), val)) {
            return type[0] === "+" || type.includes("*") ? val : type;
        }
    }
    return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXNNZWRpYVR5cGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpc01lZGlhVHlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztHQU9HO0FBRUgsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRWhELFNBQVMsU0FBUyxDQUFDLFFBQTRCLEVBQUUsTUFBYztJQUM3RCxJQUFJLFFBQVEsS0FBSyxTQUFTLEVBQUU7UUFDMUIsT0FBTyxLQUFLLENBQUM7S0FDZDtJQUVELE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdEMsTUFBTSxhQUFhLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUUxQyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQzFELE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFFRCxNQUFNLENBQUMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxHQUFHLFdBQVcsQ0FBQztJQUNoRCxNQUFNLENBQUMsWUFBWSxFQUFFLGVBQWUsQ0FBQyxHQUFHLGFBQWEsQ0FBQztJQUV0RCxJQUFJLFlBQVksS0FBSyxHQUFHLElBQUksWUFBWSxLQUFLLFVBQVUsRUFBRTtRQUN2RCxPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsSUFBSSxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDekMsT0FBTyxDQUNMLGVBQWUsQ0FBQyxNQUFNLElBQUksYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDO1lBQ2xELGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUN2QixhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQ25ELENBQUM7S0FDSDtJQUVELElBQUksZUFBZSxLQUFLLEdBQUcsSUFBSSxlQUFlLEtBQUssYUFBYSxFQUFFO1FBQ2hFLE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxJQUFZO0lBQzdCLElBQUksSUFBSSxLQUFLLFlBQVksRUFBRTtRQUN6QixPQUFPLG1DQUFtQyxDQUFDO0tBQzVDO1NBQU0sSUFBSSxJQUFJLEtBQUssV0FBVyxFQUFFO1FBQy9CLE9BQU8sYUFBYSxDQUFDO0tBQ3RCO1NBQU0sSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFO1FBQzFCLE9BQU8sTUFBTSxJQUFJLEVBQUUsQ0FBQztLQUNyQjtJQUNELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDbEQsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLEtBQWE7SUFDbEMsSUFBSTtRQUNGLE1BQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3JCO0lBQUMsTUFBTTtRQUNOLE9BQU87S0FDUjtBQUNILENBQUM7QUFLRCxNQUFNLFVBQVUsV0FBVyxDQUFDLEtBQWEsRUFBRSxLQUFlO0lBQ3hELE1BQU0sR0FBRyxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUVqQyxJQUFJLENBQUMsR0FBRyxFQUFFO1FBQ1IsT0FBTyxLQUFLLENBQUM7S0FDZDtJQUVELElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFO1FBQ2pCLE9BQU8sR0FBRyxDQUFDO0tBQ1o7SUFFRCxLQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssRUFBRTtRQUN4QixJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDbkMsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1NBQzNEO0tBQ0Y7SUFFRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFkYXB0ZWQgZGlyZWN0bHkgZnJvbSB0eXBlLWlzIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9qc2h0dHAvdHlwZS1pcy9cbiAqIHdoaWNoIGlzIGxpY2Vuc2VkIGFzIGZvbGxvd3M6XG4gKlxuICogQ29weXJpZ2h0KGMpIDIwMTQgSm9uYXRoYW4gT25nXG4gKiBDb3B5cmlnaHQoYykgMjAxNC0yMDE1IERvdWdsYXMgQ2hyaXN0b3BoZXIgV2lsc29uXG4gKiBNSVQgTGljZW5zZWRcbiAqL1xuXG5pbXBvcnQgeyBsb29rdXAgfSBmcm9tIFwiLi9kZXBzLnRzXCI7XG5pbXBvcnQgeyBmb3JtYXQsIHBhcnNlIH0gZnJvbSBcIi4vbWVkaWFUeXBlci50c1wiO1xuXG5mdW5jdGlvbiBtaW1lTWF0Y2goZXhwZWN0ZWQ6IHN0cmluZyB8IHVuZGVmaW5lZCwgYWN0dWFsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgaWYgKGV4cGVjdGVkID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBhY3R1YWxQYXJ0cyA9IGFjdHVhbC5zcGxpdChcIi9cIik7XG4gIGNvbnN0IGV4cGVjdGVkUGFydHMgPSBleHBlY3RlZC5zcGxpdChcIi9cIik7XG5cbiAgaWYgKGFjdHVhbFBhcnRzLmxlbmd0aCAhPT0gMiB8fCBleHBlY3RlZFBhcnRzLmxlbmd0aCAhPT0gMikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnN0IFthY3R1YWxUeXBlLCBhY3R1YWxTdWJ0eXBlXSA9IGFjdHVhbFBhcnRzO1xuICBjb25zdCBbZXhwZWN0ZWRUeXBlLCBleHBlY3RlZFN1YnR5cGVdID0gZXhwZWN0ZWRQYXJ0cztcblxuICBpZiAoZXhwZWN0ZWRUeXBlICE9PSBcIipcIiAmJiBleHBlY3RlZFR5cGUgIT09IGFjdHVhbFR5cGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoZXhwZWN0ZWRTdWJ0eXBlLnN1YnN0cigwLCAyKSA9PT0gXCIqK1wiKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIGV4cGVjdGVkU3VidHlwZS5sZW5ndGggPD0gYWN0dWFsU3VidHlwZS5sZW5ndGggKyAxICYmXG4gICAgICBleHBlY3RlZFN1YnR5cGUuc3Vic3RyKDEpID09PVxuICAgICAgICBhY3R1YWxTdWJ0eXBlLnN1YnN0cigxIC0gZXhwZWN0ZWRTdWJ0eXBlLmxlbmd0aClcbiAgICApO1xuICB9XG5cbiAgaWYgKGV4cGVjdGVkU3VidHlwZSAhPT0gXCIqXCIgJiYgZXhwZWN0ZWRTdWJ0eXBlICE9PSBhY3R1YWxTdWJ0eXBlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZSh0eXBlOiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICBpZiAodHlwZSA9PT0gXCJ1cmxlbmNvZGVkXCIpIHtcbiAgICByZXR1cm4gXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIjtcbiAgfSBlbHNlIGlmICh0eXBlID09PSBcIm11bHRpcGFydFwiKSB7XG4gICAgcmV0dXJuIFwibXVsdGlwYXJ0LypcIjtcbiAgfSBlbHNlIGlmICh0eXBlWzBdID09PSBcIitcIikge1xuICAgIHJldHVybiBgKi8qJHt0eXBlfWA7XG4gIH1cbiAgcmV0dXJuIHR5cGUuaW5jbHVkZXMoXCIvXCIpID8gdHlwZSA6IGxvb2t1cCh0eXBlKTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplVHlwZSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB2YWwgPSB2YWx1ZS5zcGxpdChcIjtcIik7XG4gICAgY29uc3QgdHlwZSA9IHBhcnNlKHZhbFswXSk7XG4gICAgcmV0dXJuIGZvcm1hdCh0eXBlKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuO1xuICB9XG59XG5cbi8qKiBHaXZlbiBhIHZhbHVlIG9mIHRoZSBjb250ZW50IHR5cGUgb2YgYSByZXF1ZXN0IGFuZCBhbiBhcnJheSBvZiB0eXBlcyxcbiAqIHByb3ZpZGUgdGhlIG1hdGNoaW5nIHR5cGUgb3IgYGZhbHNlYCBpZiBubyB0eXBlcyBhcmUgbWF0Y2hlZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzTWVkaWFUeXBlKHZhbHVlOiBzdHJpbmcsIHR5cGVzOiBzdHJpbmdbXSk6IHN0cmluZyB8IGZhbHNlIHtcbiAgY29uc3QgdmFsID0gbm9ybWFsaXplVHlwZSh2YWx1ZSk7XG5cbiAgaWYgKCF2YWwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoIXR5cGVzLmxlbmd0aCkge1xuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICBmb3IgKGNvbnN0IHR5cGUgb2YgdHlwZXMpIHtcbiAgICBpZiAobWltZU1hdGNoKG5vcm1hbGl6ZSh0eXBlKSwgdmFsKSkge1xuICAgICAgcmV0dXJuIHR5cGVbMF0gPT09IFwiK1wiIHx8IHR5cGUuaW5jbHVkZXMoXCIqXCIpID8gdmFsIDogdHlwZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG4iXX0=