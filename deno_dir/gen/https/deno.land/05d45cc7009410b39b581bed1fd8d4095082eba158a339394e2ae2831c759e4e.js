import { WireProtocol } from "./protocol/mod.ts";
import { AuthContext, ScramAuthPlugin, X509AuthPlugin } from "./auth/mod.ts";
import { MongoDriverError } from "./error.ts";
export class Cluster {
    #options;
    #connections;
    #protocols;
    #masterIndex;
    constructor(options) {
        this.#options = options;
        this.#connections = [];
        this.#protocols = [];
        this.#masterIndex = -1;
    }
    async connect() {
        const options = this.#options;
        this.#connections = await Promise.all(options.servers.map((server) => this.connectToServer(server, options)));
    }
    connectToServer(server, options) {
        const denoConnectOps = {
            hostname: server.host,
            port: server.port,
        };
        if (!options.tls)
            return Deno.connect(denoConnectOps);
        if (options.certFile) {
            denoConnectOps.caCerts = [Deno.readTextFileSync(options.certFile)];
        }
        if (options.keyFile) {
            if (options.keyFilePassword) {
                throw new MongoDriverError("Tls keyFilePassword not implemented in Deno driver");
            }
            throw new MongoDriverError("Tls keyFile not implemented in Deno driver");
        }
        return Deno.connectTls(denoConnectOps);
    }
    async authenticate() {
        const options = this.#options;
        this.#protocols = await Promise.all(this.#connections.map((conn) => this.authenticateToServer(conn, options)));
    }
    async authenticateToServer(conn, options) {
        const protocol = new WireProtocol(conn);
        if (options.credential) {
            const authContext = new AuthContext(protocol, options.credential, options);
            const mechanism = options.credential.mechanism;
            let authPlugin;
            if (mechanism === "SCRAM-SHA-256") {
                authPlugin = new ScramAuthPlugin("sha256");
            }
            else if (mechanism === "SCRAM-SHA-1") {
                authPlugin = new ScramAuthPlugin("sha1");
            }
            else if (mechanism === "MONGODB-X509") {
                authPlugin = new X509AuthPlugin();
            }
            else {
                throw new MongoDriverError(`Auth mechanism not implemented in Deno driver: ${mechanism}`);
            }
            const request = authPlugin.prepare(authContext);
            authContext.response = await protocol.commandSingle("admin", request);
            await authPlugin.auth(authContext);
        }
        else {
            await protocol.connect();
        }
        return protocol;
    }
    async updateMaster() {
        const results = await Promise.all(this.#protocols.map((protocol) => {
            return protocol.commandSingle("admin", { isMaster: 1 });
        }));
        const masterIndex = results.findIndex((result) => result.isWritablePrimary || result.ismaster);
        if (masterIndex === -1)
            throw new Error(`Could not find a master node`);
        this.#masterIndex = masterIndex;
    }
    getMaster() {
        return {
            protocol: this.#protocols[this.#masterIndex],
            conn: this.#connections[this.#masterIndex],
        };
    }
    get protocol() {
        return this.getMaster().protocol;
    }
    close() {
        for (const conn of this.#connections) {
            try {
                conn.close();
            }
            catch (error) {
                console.error(`Error closing connection: ${error}`);
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2x1c3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNsdXN0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRWpELE9BQU8sRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFHOUMsTUFBTSxPQUFPLE9BQU87SUFDbEIsUUFBUSxDQUFpQjtJQUN6QixZQUFZLENBQWM7SUFDMUIsVUFBVSxDQUFpQjtJQUMzQixZQUFZLENBQVM7SUFFckIsWUFBWSxPQUF1QjtRQUNqQyxJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztRQUN4QixJQUFJLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxLQUFLLENBQUMsT0FBTztRQUNYLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDOUIsSUFBSSxDQUFDLFlBQVksR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQ25DLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUN2RSxDQUFDO0lBQ0osQ0FBQztJQUVELGVBQWUsQ0FBQyxNQUFjLEVBQUUsT0FBdUI7UUFDckQsTUFBTSxjQUFjLEdBQTJCO1lBQzdDLFFBQVEsRUFBRSxNQUFNLENBQUMsSUFBSTtZQUNyQixJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUk7U0FDbEIsQ0FBQztRQUVGLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRztZQUFF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Q0YsSUFBSSxXQUFXLEtBQUssQ0FBQyxDQUFDO1lBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1FBQ3hFLElBQUksQ0FBQyxZQUFZLEdBQUcsV0FBVyxDQUFDO0lBQ2xDLENBQUM7SUFFTyxTQUFTO1FBQ2YsT0FBTztZQUNMLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7WUFDNUMsSUFBSSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQztTQUMzQyxDQUFDO0lBQ0osQ0FBQztJQUVELElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQztJQUNuQyxDQUFDO0lBRUQsS0FBSztRQUNILEtBQUssTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNwQyxJQUFJO2dCQUNGLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUNkO1lBQUMsT0FBTyxLQUFLLEVBQUU7Z0JBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsS0FBSyxFQUFFLENBQUMsQ0FBQzthQUNyRDtTQUNGO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgV2lyZVByb3RvY29sIH0gZnJvbSBcIi4vcHJvdG9jb2wvbW9kLnRzXCI7XG5pbXBvcnQgeyBDb25uZWN0T3B0aW9ucyB9IGZyb20gXCIuL3R5cGVzLnRzXCI7XG5pbXBvcnQgeyBBdXRoQ29udGV4dCwgU2NyYW1BdXRoUGx1Z2luLCBYNTA5QXV0aFBsdWdpbiB9IGZyb20gXCIuL2F1dGgvbW9kLnRzXCI7XG5pbXBvcnQgeyBNb25nb0RyaXZlckVycm9yIH0gZnJvbSBcIi4vZXJyb3IudHNcIjtcbmltcG9ydCB7IFNlcnZlciB9IGZyb20gXCIuL3R5cGVzLnRzXCI7XG5cbmV4cG9ydCBjbGFzcyBDbHVzdGVyIHtcbiAgI29wdGlvbnM6IENvbm5lY3RPcHRpb25zO1xuICAjY29ubmVjdGlvbnM6IERlbm8uQ29ubltdO1xuICAjcHJvdG9jb2xzOiBXaXJlUHJvdG9jb2xbXTtcbiAgI21hc3RlckluZGV4OiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogQ29ubmVjdE9wdGlvbnMpIHtcbiAgICB0aGlzLiNvcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLiNjb25uZWN0aW9ucyA9IFtdO1xuICAgIHRoaXMuI3Byb3RvY29scyA9IFtdO1xuICAgIHRoaXMuI21hc3RlckluZGV4ID0gLTE7XG4gIH1cblxuICBhc3luYyBjb25uZWN0KCkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLiNvcHRpb25zO1xuICAgIHRoaXMuI2Nvbm5lY3Rpb25zID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBvcHRpb25zLnNlcnZlcnMubWFwKChzZXJ2ZXIpID0+IHRoaXMuY29ubmVjdFRvU2VydmVyKHNlcnZlciwgb3B0aW9ucykpLFxuICAgICk7XG4gIH1cblxuICBjb25uZWN0VG9TZXJ2ZXIoc2VydmVyOiBTZXJ2ZXIsIG9wdGlvbnM6IENvbm5lY3RPcHRpb25zKSB7XG4gICAgY29uc3QgZGVub0Nvbm5lY3RPcHM6IERlbm8uQ29ubmVjdFRsc09wdGlvbnMgPSB7XG4gICAgICBob3N0bmFtZTogc2VydmVyLmhvc3QsXG4gICAgICBwb3J0OiBzZXJ2ZXIucG9ydCxcbiAgICB9O1xuXG4gICAgaWYgKCFvcHRpb25zLnRscykgcmV0dXJuIERlbm8uY29ubmVjdChkZW5vQ29ubmVjdE9wcyk7XG5cbiAgICBpZiAob3B0aW9ucy5jZXJ0RmlsZSkge1xuICAgICAgZGVub0Nvbm5lY3RPcHMuY2FDZXJ0cyA9IFtEZW5vLnJlYWRUZXh0RmlsZVN5bmMob3B0aW9ucy5jZXJ0RmlsZSldO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmtleUZpbGUpIHtcbiAgICAgIC8vVE9ETzogbmVlZCBzb21ldGhpbmcgbGlrZSBjb25zdCBrZXkgPSBkZWNyeXB0KG9wdGlvbnMua2V5RmlsZSkgLi4uXG4gICAgICBpZiAob3B0aW9ucy5rZXlGaWxlUGFzc3dvcmQpIHtcbiAgICAgICAgdGhyb3cgbmV3IE1vbmdvRHJpdmVyRXJyb3IoXG4gICAgICAgICAgXCJUbHMga2V5RmlsZVBhc3N3b3JkIG5vdCBpbXBsZW1lbnRlZCBpbiBEZW5vIGRyaXZlclwiLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IE1vbmdvRHJpdmVyRXJyb3IoXCJUbHMga2V5RmlsZSBub3QgaW1wbGVtZW50ZWQgaW4gRGVubyBkcml2ZXJcIik7XG4gICAgICAvL1RPRE86IG5lZWQgRGVuby5jb25uZWN0VGxzIHdpdGggc29tZXRoaW5nIGxpa2Uga2V5IG9yIGtleUZpbGUgb3B0aW9uLlxuICAgIH1cblxuICAgIHJldHVybiBEZW5vLmNvbm5lY3RUbHMoZGVub0Nvbm5lY3RPcHMpO1xuICB9XG5cbiAgYXN5bmMgYXV0aGVudGljYXRlKCkge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLiNvcHRpb25zO1xuICAgIHRoaXMuI3Byb3RvY29scyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgdGhpcy4jY29ubmVjdGlvbnMubWFwKChjb25uKSA9PiB0aGlzLmF1dGhlbnRpY2F0ZVRvU2VydmVyKGNvbm4sIG9wdGlvbnMpKSxcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgYXV0aGVudGljYXRlVG9TZXJ2ZXIoY29ubjogRGVuby5Db25uLCBvcHRpb25zOiBDb25uZWN0T3B0aW9ucykge1xuICAgIGNvbnN0IHByb3RvY29sID0gbmV3IFdpcmVQcm90b2NvbChjb25uKTtcbiAgICBpZiAob3B0aW9ucy5jcmVkZW50aWFsKSB7XG4gICAgICBjb25zdCBhdXRoQ29udGV4dCA9IG5ldyBBdXRoQ29udGV4dChcbiAgICAgICAgcHJvdG9jb2wsXG4gICAgICAgIG9wdGlvbnMuY3JlZGVudGlhbCxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICk7XG4gICAgICBjb25zdCBtZWNoYW5pc20gPSBvcHRpb25zLmNyZWRlbnRpYWwhLm1lY2hhbmlzbTtcbiAgICAgIGxldCBhdXRoUGx1Z2luO1xuICAgICAgaWYgKG1lY2hhbmlzbSA9PT0gXCJTQ1JBTS1TSEEtMjU2XCIpIHtcbiAgICAgICAgYXV0aFBsdWdpbiA9IG5ldyBTY3JhbUF1dGhQbHVnaW4oXCJzaGEyNTZcIik7IC8vVE9ETyBBSlVTVCBzaGEyNTZcbiAgICAgIH0gZWxzZSBpZiAobWVjaGFuaXNtID09PSBcIlNDUkFNLVNIQS0xXCIpIHtcbiAgICAgICAgYXV0aFBsdWdpbiA9IG5ldyBTY3JhbUF1dGhQbHVnaW4oXCJzaGExXCIpO1xuICAgICAgfSBlbHNlIGlmIChtZWNoYW5pc20gPT09IFwiTU9OR09EQi1YNTA5XCIpIHtcbiAgICAgICAgYXV0aFBsdWdpbiA9IG5ldyBYNTA5QXV0aFBsdWdpbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IE1vbmdvRHJpdmVyRXJyb3IoXG4gICAgICAgICAgYEF1dGggbWVjaGFuaXNtIG5vdCBpbXBsZW1lbnRlZCBpbiBEZW5vIGRyaXZlcjogJHttZWNoYW5pc219YCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBhdXRoUGx1Z2luLnByZXBhcmUoYXV0aENvbnRleHQpO1xuICAgICAgYXV0aENvbnRleHQucmVzcG9uc2UgPSBhd2FpdCBwcm90b2NvbC5jb21tYW5kU2luZ2xlKFxuICAgICAgICBcImFkbWluXCIsIC8vIFRPRE86IFNob3VsZCBnZXQgdGhlIGF1dGggZGIgZnJvbSBjb25uZWN0aW9uT3B0aW9ucz9cbiAgICAgICAgcmVxdWVzdCxcbiAgICAgICk7XG4gICAgICBhd2FpdCBhdXRoUGx1Z2luLmF1dGgoYXV0aENvbnRleHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBwcm90b2NvbC5jb25uZWN0KCk7XG4gICAgfVxuICAgIHJldHVybiBwcm90b2NvbDtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZU1hc3RlcigpIHtcbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwodGhpcy4jcHJvdG9jb2xzLm1hcCgocHJvdG9jb2wpID0+IHtcbiAgICAgIHJldHVybiBwcm90b2NvbC5jb21tYW5kU2luZ2xlKFxuICAgICAgICBcImFkbWluXCIsXG4gICAgICAgIHsgaXNNYXN0ZXI6IDEgfSxcbiAgICAgICk7XG4gICAgfSkpO1xuICAgIGNvbnN0IG1hc3RlckluZGV4ID0gcmVzdWx0cy5maW5kSW5kZXgoKHJlc3VsdCkgPT5cbiAgICAgIHJlc3VsdC5pc1dyaXRhYmxlUHJpbWFyeSB8fCByZXN1bHQuaXNtYXN0ZXJcbiAgICApO1xuICAgIGlmIChtYXN0ZXJJbmRleCA9PT0gLTEpIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgYSBtYXN0ZXIgbm9kZWApO1xuICAgIHRoaXMuI21hc3RlckluZGV4ID0gbWFzdGVySW5kZXg7XG4gIH1cblxuICBwcml2YXRlIGdldE1hc3RlcigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcHJvdG9jb2w6IHRoaXMuI3Byb3RvY29sc1t0aGlzLiNtYXN0ZXJJbmRleF0sXG4gICAgICBjb25uOiB0aGlzLiNjb25uZWN0aW9uc1t0aGlzLiNtYXN0ZXJJbmRleF0sXG4gICAgfTtcbiAgfVxuXG4gIGdldCBwcm90b2NvbCgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRNYXN0ZXIoKS5wcm90b2NvbDtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIGZvciAoY29uc3QgY29ubiBvZiB0aGlzLiNjb25uZWN0aW9ucykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29ubi5jbG9zZSgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgY2xvc2luZyBjb25uZWN0aW9uOiAke2Vycm9yfWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19